<!doctype html>

<html>

<head>
  <meta charset="utf-8">
  <title>Hello World</title>
  <style>* {padding: 0; margin: 0}</style>
</head>

<script src="{{url_for('static', filename='pixi.min.js')}}"></script>
<script src="{{url_for('static', filename='GameLoop.js')}}"></script>
<script src="{{url_for('static', filename='sparkExplosion.js')}}"></script>
<script src="{{url_for('static', filename='hendrixGrid.js')}}"></script>
<script src="{{url_for('static', filename='zappaGrid.js')}}"></script>
<script src="{{url_for('static', filename='tartiniGrid.js')}}"></script>
<script src="{{url_for('static', filename='devilGrid.js')}}"></script>
<script src="{{url_for('static', filename='princeGrid.js')}}"></script>
<script src="{{url_for('static', filename='makemap.js')}}"> </script>
<script src ="{{url_for('static', filename='spawnNote.js')}}"></script>
<script src ="{{url_for('static', filename='rhythmLogic.js')}}"></script>
<script src ="{{url_for('static', filename='pixi-sound.js')}}"></script>
<script src ="{{url_for('static', filename='PlayerController.js')}}"></script>
<script src ="{{url_for('static', filename='KeyController.js')}}"></script>
<script src ="{{url_for('static', filename='viewLoader.js')}}"></script>
<script src ="{{url_for('static', filename='enemyEnum.js')}}"></script>

<body>
  <script type="text/javascript">
  const sprites = {};

  //Aliases
  const Application = PIXI.Application,
  loader = PIXI.loader,
  resources = PIXI.loader.resources,
  Sprite = PIXI.Sprite;

  //Create a Pixi Application
  const app = new Application({
    width: 1000,
    height: 700,
    antialias: true,
    transparent: false,
    resolution: 1
  });

  var ready = false;
  var life = 3;
  var crashCheck = false;
  var charswitch = 0;
  var mainswitch = 0;
  var killswitch = 0;
  var enemyNumber = enemyEnum['zappa'];

  //Add the canvas that Pixi automatically created for you to the HTML document
  document.body.appendChild(app.view);
  loadView(enemyNumber);

  var mapTextures = setupMap();
  // buildMap(mapTextures);

  // buildMap(mapTextures);

  var track="";
  switch (enemyNumber){
    case 2: //Hendrix
    track="static/audio/Tartini.mp3"
    break;
    case 5: //Zappa
    track="static/audio/Disco.mp3"
    break;
    case 6://Prince
    track= "static/audio/Quick.mp3"
    break;
    case 3: //Tartini
    track = "static/audio/Tartini.mp3"
    break;
    case 4: //Tartini Devil
    track = "static/audio/TartiniDevil.mp3"
    break;
    case 0: //Intro, any monster
    track = "static/audio/Intro.mp3"
    break;
  }


  var MM = new musicManager(track,
    [ '00000000000000110000000000001100000000000000001100000000000011000000110000000000000011000000000000000000000000000000110000001100',
    '00000000110000000000000011000000000000001100000000000000110000000000000000001100000000000000110000000000000011001100000011000000',
    '00001100000000000000110000000000000011000000000000001100000000001100000000000000110000000000000000001100110000000000000000000000',
    '11000000000000001100000000000000110000000000000011000000000000000000000001100000000000001100000011000000000000000000000000000000'],
    4*151,
    6.0);

    //Set the game state
    state = play;
    //Start the game loop
    app.ticker.add(delta => gameLoop(delta));
    f = (delta) => MM.update(delta);
    MM.f = f;
    app.ticker.add(f);
    MM.startTrack();


    function gameLoop(delta){
      //Update the current game state:
      state(delta);
    }

    function play(delta) {
      loader.onComplete.add(() => {
        ready = true;
        bindKeys();
      });
      if (ready){
        //play dodge component
        dodgeNotes();
        //animations
        characterChanger();
        //animations
        mainChanger();
        //binds the keys
      }
    }

    function dodgeNotes(){
      if (MM.handleCrash(sprites.player.x, sprites.player.y)){
        lifeHit();
        console.log("crash");
      }
    }

    function killChar(){
      if (killswitch < 30){
        character1.visible= false;
        character2.visible = false;
        character3.visible = false;
        character4.visible = false;
        characterV.visible = true;
        killswitch++;
      }
      else if (killswitch < 60){
        characterV.visible = false;
        characterH.visible = true;
        killswitch++;
      }
      else {
        killswitch = 0;
        //destroyScene();
      }
    }


    //dont open this @Artem PlZ
    function characterChanger(){
      if (charswitch < 30){
        charswitch++;}
        else if (charswitch < 60){
          charswitch++;
          character1.visible = false;
          character2.visible = true;
        }else if (charswitch < 90){
          charswitch++;
          character2.visible = false;
          character3.visible = true;
        }else if (charswitch < 120){
          charswitch++;
          character3.visible = false;
          character4.visible = true;
        }else{
          charswitch = 0;
          character4.visible = false;
          character1.visible = true;
        }
      }


      function mainChanger(){
        if (mainswitch < 30){
          mainswitch++;
        }else if (mainswitch < 60){
          mainswitch++;
          m01.visible = false;
          m02.visible = true;
        }else if (mainswitch < 90){
          mainswitch++;
          m02.visible = false;
          m03.visible = true;
        }else{
          mainswitch = 0;
          m03.visible = false;
          m01.visible = true;
        }
      }

      function lifeHit(){
        life--;
        //console.log(life);
      }


      </script>
    </body>
    </html>
