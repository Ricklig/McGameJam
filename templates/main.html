<!doctype html>

<html>

<head>
  <meta charset="utf-8">
  <title>Hello World</title>
  <style>* {padding: 0; margin: 0}</style>
</head>

<script src="{{url_for('static', filename='pixi.min.js')}}"></script>
<script src="{{url_for('static', filename='GameLoop.js')}}"></script>
<script src="{{url_for('static', filename='hendrixGrid.js')}}"></script>
<script src="{{url_for('static', filename='zappaGrid.js')}}"></script>
<script src="{{url_for('static', filename='tartiniGrid.js')}}"></script>
<script src="{{url_for('static', filename='princeGrid.js')}}"></script>
<script src="{{url_for('static', filename='makemap.js')}}"> </script>
<script src ="{{url_for('static', filename='spawnNote.js')}}"></script>
<script src ="{{url_for('static', filename='rhythmLogic.js')}}"></script>
<script src ="{{url_for('static', filename='PlayerController.js')}}"></script>
<script src ="{{url_for('static', filename='KeyController.js')}}"></script>
<script src ="{{url_for('static', filename='pixi-sound.js')}}"></script>

<body>
  <script type="text/javascript">
  const sprites = {};



  //Aliases
  const Application = PIXI.Application,
  loader = PIXI.loader,
  resources = PIXI.loader.resources,
  Sprite = PIXI.Sprite;

  //Create a Pixi Application
  const app = new Application({
    width: 1000,
    height: 700,
    antialias: true,
    transparent: false,
    resolution: 1
  }
);

var ready = false;
var life = 3;
var crashCheck = false;
var charswitch = 0;
var mainswitch = 0;
var viewLoader = 3;


//Add the canvas that Pixi automatically created for you to the HTML document
document.body.appendChild(app.view);

//load an image and run the `setup` function when it's done
if (viewLoader == 0){
  loader
  .add("{{url_for('static', filename='images/test1.png')}}")
  .add("{{url_for('static', filename='images/note1.png')}}")
  .add("{{url_for('static', filename='images/note1Light.png')}}")
  .add("{{url_for('static', filename='images/note2.png')}}")
  .add("{{url_for('static', filename='images/note2Light.png')}}")
  .add("{{url_for('static', filename='images/note3.png')}}")
  .add("{{url_for('static', filename='images/note3Light.png')}}")
  .add("{{url_for('static', filename='images/note4.png')}}")
  .add("{{url_for('static', filename='images/note4Light.png')}}")
  .add("{{url_for('static', filename='images/Hendrix.png')}}")
  .add("{{url_for('static', filename='images/Hendrix1.png')}}")
  .add("{{url_for('static', filename='images/Hendrix2.png')}}")
  .add("{{url_for('static', filename='images/Hendrix3.png')}}")
  .add("{{url_for('static', filename='images/mc0.png')}}")
  .add("{{url_for('static', filename='images/mc02.png')}}")
  .add("{{url_for('static', filename='images/mc03.png')}}")
  .add("{{url_for('static', filename='images/background1.png')}}")
  .load(hendrixSetup);
}

if(viewLoader == 1){
  loader
  .add("{{url_for('static', filename='images/test1.png')}}")
  .add("{{url_for('static', filename='images/note1.png')}}")
  .add("{{url_for('static', filename='images/note1Light.png')}}")
  .add("{{url_for('static', filename='images/note2.png')}}")
  .add("{{url_for('static', filename='images/note2Light.png')}}")
  .add("{{url_for('static', filename='images/note3.png')}}")
  .add("{{url_for('static', filename='images/note3Light.png')}}")
  .add("{{url_for('static', filename='images/note4.png')}}")
  .add("{{url_for('static', filename='images/note4Light.png')}}")
  .add("{{url_for('static', filename='images/Zappa.png')}}")
  .add("{{url_for('static', filename='images/Zappa1.png')}}")
  .add("{{url_for('static', filename='images/Zappa2.png')}}")
  .add("{{url_for('static', filename='images/Zappa3.png')}}")
  .add("{{url_for('static', filename='images/mc0.png')}}")
  .add("{{url_for('static', filename='images/mc02.png')}}")
  .add("{{url_for('static', filename='images/mc03.png')}}")
  .add("{{url_for('static', filename='images/background1.png')}}")
  .load(zappaSetup);
}

if(viewLoader == 2){
  loader
  .add("{{url_for('static', filename='images/test1.png')}}")
  .add("{{url_for('static', filename='images/note1.png')}}")
  .add("{{url_for('static', filename='images/note1Light.png')}}")
  .add("{{url_for('static', filename='images/note2.png')}}")
  .add("{{url_for('static', filename='images/note2Light.png')}}")
  .add("{{url_for('static', filename='images/note3.png')}}")
  .add("{{url_for('static', filename='images/note3Light.png')}}")
  .add("{{url_for('static', filename='images/note4.png')}}")
  .add("{{url_for('static', filename='images/note4Light.png')}}")
  .add("{{url_for('static', filename='images/Prince.png')}}")
  .add("{{url_for('static', filename='images/Prince1.png')}}")
  .add("{{url_for('static', filename='images/Prince2.png')}}")
  .add("{{url_for('static', filename='images/Prince3.png')}}")
  .add("{{url_for('static', filename='images/mc0.png')}}")
  .add("{{url_for('static', filename='images/mc02.png')}}")
  .add("{{url_for('static', filename='images/mc03.png')}}")
  .add("{{url_for('static', filename='images/background1.png')}}")
  .load(princeSetup);
}
if(viewLoader == 3){
  loader
  .add("{{url_for('static', filename='images/test1.png')}}")
  .add("{{url_for('static', filename='images/note1.png')}}")
  .add("{{url_for('static', filename='images/note1Light.png')}}")
  .add("{{url_for('static', filename='images/note2.png')}}")
  .add("{{url_for('static', filename='images/note2Light.png')}}")
  .add("{{url_for('static', filename='images/note3.png')}}")
  .add("{{url_for('static', filename='images/note3Light.png')}}")
  .add("{{url_for('static', filename='images/note4.png')}}")
  .add("{{url_for('static', filename='images/note4Light.png')}}")
  .add("{{url_for('static', filename='images/Tartini.png')}}")
  .add("{{url_for('static', filename='images/Tartini1.png')}}")
  .add("{{url_for('static', filename='images/Tartini2.png')}}")
  .add("{{url_for('static', filename='images/Tartini3.png')}}")
  .add("{{url_for('static', filename='images/TartiniDeadH.png')}}")
  .add("{{url_for('static', filename='images/TartiniDeadV.png')}}")
  .add("{{url_for('static', filename='images/mc0.png')}}")
  .add("{{url_for('static', filename='images/mc02.png')}}")
  .add("{{url_for('static', filename='images/mc03.png')}}")
  .add("{{url_for('static', filename='images/background1.png')}}")
  .load(tartiniSetup);
}

var mapTextures = setupMap();
// buildMap(mapTextures);

var track="";
switch (viewLoader){
	case 0: //Hendrix
		track="static/audio/Tartini.mp3"
		break;
	case 1: //Zappa
		track="static/audio/Disco.mp3"
		break;
	case 2://Prince
		track= "static/audio/Quick.mp3" 
		break;
	case 3: //Tartini
		track = "static/audio/Tartini.mp3"
		break;
	case 4: //Tartini Devil
		track = "static/audio/TartiniDevil.mp3"
		break;
	case 5: //Intro, any monster
		track = "static/audio/Intro.mp3"
		break;

)
	

var MM = new musicManager(track,
[ '00000000000000110000000000001100000000000000001100000000000011000000110000000000000011000000000000000000000000000000110000001100',
'00000000110000000000000011000000000000001100000000000000110000000000000000001100000000000000110000000000000011001100000011000000',
'00001100000000000000110000000000000011000000000000001100000000001100000000000000110000000000000000001100110000000000000000000000',
'11000000000000001100000000000000110000000000000011000000000000000000000001100000000000001100000011000000000000000000000000000000'],
4*151,
6.0);

//Set the game state
state = play;
//Start the game loop
app.ticker.add(delta => gameLoop(delta));
app.ticker.add(delta => MM.update(delta));
MM.startTrack();

function gameLoop(delta){
  //Update the current game state:
  state(delta);
}

function play(delta) {
  loader.onComplete.add(() => ready = true);
  if (ready){
    //play dodge component
    dodgeNotes();

    //animations
    characterChanger();

    //animations
    mainChanger();

  }
}

function dodgeNotes(){
  if (MM.handleCrash(sprites.player.x, sprites.player.y)){
    lifeHit();
    console.log("crash");
  }
}

//dont open this @Artem PlZ
function characterChanger(){
  if (charswitch < 30){
    charswitch++;}
    else if (charswitch < 60){
      charswitch++;
      character1.visible = false;
      character2.visible = true;
    }else if (charswitch < 90){
      charswitch++;
      character2.visible = false;
      character3.visible = true;
    }else if (charswitch < 120){
      charswitch++;
      character3.visible = false;
      character4.visible = true;
    }else{
      charswitch = 0;
      character4.visible = false;
      character1.visible = true;
    }
  }

  function mainChanger(){
    if (mainswitch < 30){
      mainswitch++;}
      else if (mainswitch < 60){
        mainswitch++;
        m01.visible = false;
        m02.visible = true;
      }else if (mainswitch < 90){
        mainswitch++;
        m02.visible = false;
        m03.visible = true;
      }else{
        mainswitch = 0;
        m03.visible = false;
        m01.visible = true;
      }
    }



    function lifeHit(){
      life--;
      //console.log(life);
    }


  </script>
</body>
</html>
