<!doctype html>

<html>
<head>
  <meta charset="utf-8">
  <title>Hello World</title>
  <style>* {padding: 0; margin: 0}</style>
</head>

<script src="{{url_for('static', filename='pixi.min.js')}}"></script>
<script src="{{url_for('static', filename='pixi-sound.js')}}"></script>
<script src="{{url_for('static', filename='GameLoop.js')}}"></script>
<script src="{{url_for('static', filename='playerGrid.js')}}"></script>
<script src="{{url_for('static', filename='makemap.js')}}"> </script>
<script src ="{{url_for('static', filename='spawnNote.js')}}"></script>
<script src ="{{url_for('static', filename='rhythmLogic.js')}}"></script>
<script src ="{{url_for('static', filename='PlayerController.js')}}"></script>
<script src ="{{url_for('static', filename='KeyController.js')}}"></script>

<body>
  <script type="text/javascript">

  //Aliases
  const Application = PIXI.Application,
  loader = PIXI.loader,
  resources = PIXI.loader.resources,
  Sprite = PIXI.Sprite;

  //Create a Pixi Application
  const app = new Application({
    width: 1000,
    height: 700,
    antialias: true,
    transparent: false,
    resolution: 1
  }
);

const playerLoc = {}
var ready = false;
var life = 3;
var crashCheck = false;

//Add the canvas that Pixi automatically created for you to the HTML document
document.body.appendChild(app.view);

//load an image and run the `setup` function when it's done
loader
.add("{{url_for('static', filename='images/test1.png')}}")
.add('keyCaps',"{{url_for('static', filename='images/KeyCaps.png')}}")
.add("{{url_for('static', filename='images/Hendrix.png')}}")
.add("{{url_for('static', filename='images/background1.png')}}")
.load(gridSetup);

var mapTextures = setupMap();
// buildMap(mapTextures);

var MM = new musicManager("static/audio/Tartini.mp3",
[ '00000000000000110000000000001100000000000000001100000000000011000000110000000000000011000000000000000000000000000000110000001100',
'00000000110000000000000011000000000000001100000000000000110000000000000000001100000000000000110000000000000011001100000011000000',
'00001100000000000000110000000000000011000000000000001100000000001100000000000000110000000000000000001100110000000000000000000000',
'11000000000000001100000000000000110000000000000011000000000000000000000001100000000000001100000011000000000000000000000000000000'],
4*151,
6.0);

//Set the game state
state = play;
//Start the game loop
app.ticker.add(delta => gameLoop(delta));
app.ticker.add(delta => MM.update(delta));
MM.startTrack();

function gameLoop(delta){
  //Update the current game state:
  state(delta);
}

function play(delta) {
  loader.onComplete.add(() => ready = true);
  if (ready){
    //play dodge component
    dodgeNotes();
  }
}

function dodgeNotes(){
  if (MM.handleCrash(sprites.player.x, sprites.player.y)){
    lifeHit();
    console.log("crash");
  }
}

function lifeHit(){
  life--;
  //console.log(life);
}


</script>
</body>
</html>
