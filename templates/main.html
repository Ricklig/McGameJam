<!doctype html>

<html>
  <head>
    <meta charset="utf-8">
    <title>Hello World</title>
    <style>* {padding: 0; margin: 0}</style>
  </head>

    <script src="{{url_for('static', filename='pixi.min.js')}}"></script>
    <script src="{{url_for('static', filename='GameLoop.js')}}"></script>
    <script src="{{url_for('static', filename='playerGrid.js')}}"></script>
    <script src="{{url_for('static', filename='makemap.js')}}"> </script>
    <script src ="{{url_for('static', filename='spawnNote.js')}}"></script>
    <script src ="{{url_for('static', filename='rhythmLogic.js')}}"></script>

    <body>
      <script type="text/javascript">

      //Aliases
  const Application = PIXI.Application,
      loader = PIXI.loader,
      resources = PIXI.loader.resources,
      Sprite = PIXI.Sprite;

  //Create a Pixi Application
  const app = new Application({
      width: 1000,
      height: 800,
      antialias: true,
      transparent: false,
      resolution: 1
    }
  );

const playerLoc = {}
var ready = false;
var life = 3;
var crashCheck = false;

  //Add the canvas that Pixi automatically created for you to the HTML document
  document.body.appendChild(app.view);

  //load an image and run the `setup` function when it's done
  loader
    .add("{{url_for('static', filename='images/test1.png')}}")
    .add('keyCaps',"{{url_for('static', filename='images/KeyCaps.png')}}")
    .add("{{url_for('static', filename='images/Hendrix.png')}}")
    .load(gridSetup);



    //Set the game state
    state = play;
    //Start the game loop
   app.ticker.add(delta => gameLoop(delta));


    function gameLoop(delta){

      //Update the current game state:
      state(delta);
    }

    function play(delta) {

      loader.onComplete.add(() => ready = true);
      if (ready){

        //play the rhythm componenet
        playRhythm();

        //play dodge component
        dodgeNotes();

      }
    }
        var mapTextures = setupMap();
        buildMap(mapTextures);

        var noteTexture = setupNote();
        // console.log('hi')
        // var note = new PIXI.Sprite({{url_for('static', filename='images/test1.png')}})
        // note.speed = speed;
        // app.stage.addChild(note);
        // note.x = app.screen.width / 2;
        // note.y = app.screen.height / 2;
        // spawnNote(noteTexture, app.screen.width / 2, app.screen.height / 2, 1.0);

        note1 = new Note(noteTexture, 50, 25, 1.0);
        app.ticker.add(note1.update);
        app.ticker.add(spawnNote(noteTexture, 150, 25, 1.0));
        app.ticker.add(spawnNote(noteTexture, 250, 25, 1.0));
        app.ticker.add(spawnNote(noteTexture, 350, 25, 1.0));

        function playRhythm(){
          //Q hit logic
          if(sprites.keyQ.click){
            console.log("Q bang");
            if(note1.sprite.y>690 && note1.sprite.y<710){
              console.log("hit");
              note1.sprite.visible = false;
            }
            else {
              console.log("miss");
              lifeHit();
            }
            sprites.keyQ.click = false;
          }

          //W hit logic
          if(sprites.keyW.click){
            console.log("W bang");
            if(note1.sprite.y>690 && note1.sprite.y<710){
              console.log("hit");
              note1.sprite.visible = false;
            }
            else {
              console.log("miss");
              lifeHit();
            }
            sprites.keyW.click = false;
          }

          //E hit logic
          if(sprites.keyE.click){
            console.log("E bang");
            if(note1.sprite.y>690 && note1.sprite.y<710){
              console.log("hit");
              note1.sprite.visible = false;
            }
            else {
              console.log("miss");
              lifeHit();
            }
            sprites.keyE.click = false;
          }

          //R hit logic
          if(sprites.keyR.click){
            console.log("R bang");
            if(note1.sprite.y>690 && note1.sprite.y<710){
              console.log("hit");
              note1.sprite.visible = false;
            }
            else {
              console.log("miss");
              lifeHit();
            }
            sprites.keyR.click = false;
          }
          if (note1.sprite.y > sprites.keyQ.y+10&& note1.sprite.visible){
            console.log("miss");
            lifeHit();
            note1.sprite.visible = false;
          }
          if (note1.sprite.y > sprites.keyW.y+10&& note1.sprite.visible){
            console.log("miss");
            lifeHit();
            note1.sprite.visible = false;
          }
          if (note1.sprite.y > sprites.keyE.y+10&& note1.sprite.visible){
            console.log("miss");
            lifeHit();
            note1.sprite.visible = false;
          }
          if (note1.sprite.y > sprites.keyR.y+10 && note1.sprite.visible){
            console.log("miss");
            lifeHit();
            note1.sprite.visible = false;
          }

        }

        function dodgeNotes(){
          if(sprites.player.x == note1.sprite.x && sprites.player.y - 5 < note1.sprite.y &&sprites.player.y+5 > note1.sprite.y&& !crashCheck){
            note1.sprite.visible = false;
            crashCheck = true;
            lifeHit();
            console.log("crash");
          }
        }

        function lifeHit(){
          life--;
          console.log(life);
        }


      </script>
    </body>
</html>
